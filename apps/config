#!/usr/bin/env bash
# ==========================================
# Sway Window Manager Configuration
# ==========================================
# Author: suraj@evenzero
# Description: Clean and organized Sway WM config
# Last Modified: $(date +%Y-%m-%d)
# ==========================================

# ==========================================
# CORE VARIABLES
# ==========================================


# Primary modifier key (Super/Windows key)
set $mod Mod4

# Vim-style directional keys
set $left h
set $down j
set $up k
set $right l

# Default applications
set $term wezterm
set $menu "wofi --show drun --style ~/.config/wofi/style.css"

# Screenshot directory
set $shots ~/Pictures/Screenshots

# ==========================================
# DISPLAY CONFIGURATION
# ==========================================

# Built-in display scaling
output eDP-1 {
    scale 0.7
}

# ==========================================
# WINDOW APPEARANCE
# ==========================================

# Window borders and gaps
default_border none
default_floating_border none
gaps inner 0
gaps outer 0

# Smart border behavior
hide_edge_borders smart

# ==========================================
# WALLPAPER MANAGEMENT (SWWW)
# ==========================================

# Start wallpaper daemon
exec swww-daemon --format xrgb

# Set random wallpaper on startup
exec_always sh -c 'until swww query >/dev/null 2>&1; do sleep 0.1; done; \
    swww img --transition-type none --resize crop "$(find "$HOME/Pictures/wallpapers" -type f \( -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.png" -o -iname "*.webp" \) | shuf -n1)"'

# Keybind to change wallpaper randomly
bindsym $mod+Shift+w exec sh -c 'swww img --transition-type none --resize crop "$(find "$HOME/Pictures/wallpapers" -type f \( -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.png" -o -iname "*.webp" \) | shuf -n1)"'

# ==========================================
# SCREENSHOT SYSTEM
# ==========================================

# Ensure screenshot directory exists
exec_always mkdir -p $shots

# Screenshot keybindings
bindsym Print exec grimshot --notify save area $shots/$(date +%Y-%m-%d_%H-%M-%S).png
bindsym Shift+Print exec grimshot --notify save output $shots/$(date +%Y-%m-%d_%H-%M-%S).png
bindsym $mod+Print exec grimshot --notify save active $shots/$(date +%Y-%m-%d_%H-%M-%S).png
bindsym Ctrl+Print exec grimshot --notify copy area

# Advanced screenshot with annotation
bindsym Alt+Print exec sh -c 'f="$HOME/Pictures/Screenshots/$(date +%Y-%m-%d_%H-%M-%S).png"; grim -g "$(slurp)" - | swappy -f - -o "$f" && notify-send "ðŸ“¸ Saved: $f"'

# Screenshot with copy and save
bindsym Ctrl+Shift+Print exec sh -c 'f="$HOME/Pictures/Screenshots/$(date +%Y-%m-%d_%H-%M-%S).png"; grim -g "$(slurp)" "$f" && wl-copy -t image/png < "$f" && notify-send "ðŸ“‹ Copied & saved: $f"'

# ==========================================
# AUDIO CONTROLS
# ==========================================

# Volume control (custom scripts with notifications)
bindsym XF86AudioRaiseVolume exec /usr/bin/volume-up
bindsym XF86AudioLowerVolume exec /usr/bin/volume-down
bindsym XF86AudioMute exec /usr/bin/volume-toggle

# Alternative volume controls (PulseAudio)
bindsym --locked XF86AudioMute exec pactl set-sink-mute @DEFAULT_SINK@ toggle
bindsym --locked XF86AudioLowerVolume exec pactl set-sink-volume @DEFAULT_SINK@ -5%
bindsym --locked XF86AudioRaiseVolume exec pactl set-sink-volume @DEFAULT_SINK@ +5%
bindsym --locked XF86AudioMicMute exec pactl set-source-mute @DEFAULT_SOURCE@ toggle

# ==========================================
# BRIGHTNESS CONTROLS
# ==========================================

bindsym --locked XF86MonBrightnessDown exec brightnessctl set 5%-
bindsym --locked XF86MonBrightnessUp exec brightnessctl set 5%+

# ==========================================
# INPUT CONFIGURATION
# ==========================================

# Universal touchpad settings
input type:touchpad {
    tap enabled
    natural_scroll enabled
    dwt enabled                    # disable-while-typing
    accel_profile adaptive
    click_method clickfinger
    middle_emulation enabled
    scroll_method two_finger
}

# Specific touchpad device configuration
input "1267:12377:ELAN1300:00_04F3:3059_Touchpad" {
    tap enabled
    natural_scroll enabled
}

# ==========================================
# BASIC KEYBINDINGS
# ==========================================

# Application launchers
bindsym $mod+Return exec $term
bindsym $mod+Shift+Return splitv, exec $term
bindsym Alt+Space exec $menu

# Window management
bindsym $mod+Shift+q kill
bindsym $mod+Shift+c reload
bindsym $mod+Shift+e exec swaynag -t warning -m 'You pressed the exit shortcut. Do you really want to exit sway? This will end your Wayland session.' -B 'Yes, exit sway' 'swaymsg exit'

# Mouse integration
floating_modifier $mod normal

# ==========================================
# WINDOW NAVIGATION
# ==========================================

# Focus movement (vim keys)
bindsym $mod+$left focus left
bindsym $mod+$down focus down
bindsym $mod+$up focus up
bindsym $mod+$right focus right

# Focus movement (arrow keys)
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# Window movement (vim keys)
bindsym $mod+Shift+$left move left
bindsym $mod+Shift+$down move down
bindsym $mod+Shift+$up move up
bindsym $mod+Shift+$right move right

# Window movement (arrow keys)
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# ==========================================
# WORKSPACE MANAGEMENT
# ==========================================

# Switch to workspace
bindsym $mod+1 workspace number 1
bindsym $mod+2 workspace number 2
bindsym $mod+3 workspace number 3
bindsym $mod+4 workspace number 4
bindsym $mod+5 workspace number 5
bindsym $mod+6 workspace number 6
bindsym $mod+7 workspace number 7
bindsym $mod+8 workspace number 8
bindsym $mod+9 workspace number 9
bindsym $mod+0 workspace number 10

# Move container to workspace
bindsym $mod+Shift+1 move container to workspace number 1
bindsym $mod+Shift+2 move container to workspace number 2
bindsym $mod+Shift+3 move container to workspace number 3
bindsym $mod+Shift+4 move container to workspace number 4
bindsym $mod+Shift+5 move container to workspace number 5
bindsym $mod+Shift+6 move container to workspace number 6
bindsym $mod+Shift+7 move container to workspace number 7
bindsym $mod+Shift+8 move container to workspace number 8
bindsym $mod+Shift+9 move container to workspace number 9
bindsym $mod+Shift+0 move container to workspace number 10

# ==========================================
# LAYOUT MANAGEMENT
# ==========================================

# Window splitting
bindsym $mod+b splith
bindsym $mod+v splitv

# Layout styles
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# Window states
bindsym $mod+f fullscreen
bindsym $mod+Shift+space floating toggle
bindsym $mod+space focus mode_toggle
bindsym $mod+a focus parent

# ==========================================
# SCRATCHPAD
# ==========================================

# Move window to/from scratchpad
bindsym $mod+Shift+minus move scratchpad
bindsym $mod+minus scratchpad show

# ==========================================
# RESIZE MODE
# ==========================================

mode "resize" {
    # Resize with vim keys
    bindsym $left resize shrink width 10px
    bindsym $down resize grow height 10px
    bindsym $up resize shrink height 10px
    bindsym $right resize grow width 10px

    # Resize with arrow keys
    bindsym Left resize shrink width 10px
    bindsym Down resize grow height 10px
    bindsym Up resize shrink height 10px
    bindsym Right resize grow width 10px

    # Exit resize mode
    bindsym Return mode "default"
    bindsym Escape mode "default"
}

# Enter resize mode
bindsym $mod+r mode "resize"

# ==========================================
# STATUS BAR
# ==========================================

bar {
    position top
    font pango:Berkeley Mono 11
    mode dock

    # Status command
    status_command i3status

    # Color scheme
    colors {
        background #00000088
        statusline #ffffff
        separator  #666666

        # Workspace colors
        focused_workspace  #000000   #ff8800   #000000
        active_workspace   #000000   #aaaaaa   #000000
        inactive_workspace #000000   #666666   #000000
        urgent_workspace   #000000   #ff0000   #000000
    }
}

# ==========================================
# ADDITIONAL CONFIGURATION
# ==========================================

# Include additional config files
include /etc/sway/config.d/*

# Make backends pick Sway
set $XDG_CURRENT_DESKTOP sway
set $XDG_SESSION_DESKTOP sway

# Ensure user systemd/dbus get your session env (incl. XDG_DATA_DIRS)
exec_always systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP XDG_SESSION_DESKTOP XDG_DATA_DIRS PATH

exec_always dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP XDG_SESSION_DESKTOP XDG_DATA_DIRS PATH

# Mako on login
exec_always mako &

# ==========================================
# NOTES & COMMENTS
# ==========================================
#
# Idle configuration example:
# exec swayidle -w \
#      timeout 300 'swaylock -f -c 000000' \
#      timeout 600 'swaymsg "output * power off"' resume 'swaymsg "output * power on"' \
#      before-sleep 'swaylock -f -c 000000'
#
# Additional output configuration:
# output HDMI-A-1 resolution 1920x1080 position 1920,0
#
# Get output names: swaymsg -t get_outputs
# Get input names: swaymsg -t get_inputs
#
