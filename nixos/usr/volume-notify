#!/usr/bin/env bash

# Get volume info
sink_info=$(wpctl get-volume @DEFAULT_AUDIO_SINK@)

# Debug: show what we got
echo "Debug: sink_info = '$sink_info'"

# Check if muted (look for MUTED in output)
if echo "$sink_info" | grep -q "MUTED"; then
    muted=true
    # Extract volume from something like "Volume: 0.50 [MUTED]"
    volume=$(echo "$sink_info" | sed 's/Volume: //' | sed 's/ \[MUTED\]//' | awk '{print int($1 * 100)}')
else
    muted=false
    # Extract volume from something like "Volume: 0.50"
    volume=$(echo "$sink_info" | sed 's/Volume: //' | awk '{print int($1 * 100)}')
fi

echo "Debug: volume=$volume, muted=$muted"

# Set icon and message
if [ "$muted" = true ]; then
    icon="audio-volume-muted"
    message="Muted"
else
    if [ "$volume" -le 0 ]; then
        icon="audio-volume-muted"
    elif [ "$volume" -le 33 ]; then
        icon="audio-volume-low"
    elif [ "$volume" -le 66 ]; then
        icon="audio-volume-medium"
    else
        icon="audio-volume-high"
    fi
    message="Volume: ${volume}%"
fi

echo "Debug: Sending notification: $message with icon $icon"

# Send notification
notify-send -a "Volume" -u low -i "$icon" \
    -h int:value:"$volume" \
    -h string:x-canonical-private-synchronous:volume \
    "$message"

echo "Debug: Done"
